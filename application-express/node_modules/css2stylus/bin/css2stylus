#!/usr/bin/env node
var fs = require('fs'),
  path = require('path'),
  args = process.argv.slice(2),
  Css2Stylus = require('../lib/css2stylus'),
  converter,
  options = {},
  readFile = function (file, callback) {
    return fs.readFile(file, 'utf-8', function (err, data) {
      if (err) { throw err; }
      callback(data);
    });
  },
  checkOption = function (option) {
    var opt = '--' + option,
      optionIndex= args.indexOf(opt),
      hasOption = optionIndex >= 0;
    if (hasOption) {
      options[option] = true;
      args.splice(optionIndex, 1);
    }
  };

if (!args.length) {
  console.log('Usage: css2stylus [options] <file1.css file2.css>');
  process.exit(1);
}

checkOption('cssSyntax');
checkOption('unPrefix');

args.forEach(function (file) {
  if (path.extname(file) === '.css') {
    var css = readFile(file, function (css) {
      var stylusfile = path.basename(file, path.extname(file)) + '.styl',
        converter = new Css2Stylus.Converter(css);
      converter.processCss(options);
      fs.writeFile(stylusfile, converter.getStylus());
    });
  }
});
